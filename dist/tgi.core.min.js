(function(){"use strict";var t={CORE:function(){return{version:"0.4.47",Application:w,Attribute:e,Command:r,Delta:o,Interface:i,List:n,Log:m,MemoryStore:E,Message:s,Model:a,Presentation:v,Procedure:h,REPLInterface:d,Request:c,Session:y,Store:l,Text:u,Transport:p,User:g,View:f,Workspace:b,inheritPrototype:q,getInvalidProperties:P,getConstructorFromModelType:_,createModelFromModelType:M,getObjectFromCPON:C,trim:T,ltrim:x,rtrim:A,left:S,center:O,right:I,lpad:L,rpad:R,cpad:D,contains:k}}};function e(t,r){var o,i,n;if(!1==this instanceof e)throw new Error("new operator required");if("string"==typeof t){var s=t;(t={}).name=s,"string"==typeof r&&(t.type=r)}t=t||{},this.name=t.name||null,this.label=t.label||t.name,this.label&&(this.label=this.label.charAt(0).toUpperCase()+this.label.slice(1)),this.type=t.type||"String",i=this.type,(n=i.split("("))[1]=parseInt(n[1]),o=n,this.type=o[0],this.hint=t.hint||{},void 0!==t.hidden&&(this.hidden=t.hidden),this.validationRule=t.validationRule||{};var a=[],h=["name","type","label","hint","hidden","value","validationRule"];switch(this.type){case"ID":a=P(t,h),this.value=t.value||null;break;case"String":a=P(t,h.concat(["placeHolder","quickPick","size"])),this.size=o[1]?o[1]:"number"==typeof t.size?t.size:t.size||50,this.value=t.value||null,t.quickPick&&(this.quickPick=t.quickPick),this.placeHolder=t.placeHolder||null;break;case"Date":a=P(t,h.concat("placeHolder")),this.value=t.value||null,this.placeHolder=t.placeHolder||null;break;case"Boolean":a=P(t,h),!1===t.value?this.value=!1:this.value=t.value||null;break;case"Number":a=P(t,h.concat("placeHolder")),0===t.value?this.value=0:this.value=t.value||null,this.placeHolder=t.placeHolder||null;break;case"Model":a=P(t,h),this.value=t.value||null,this.value instanceof e.ModelID&&(this.modelType=this.value.modelType);break;case"Group":a=P(t,h),this.value=t.value||null;break;case"Table":a=P(t,h.concat("group")),this.value=t.value||null,this.group=t.group||null;break;case"Object":a=P(t,h),this.value=t.value||null}for(var c=this.getObjectStateErrors(),l=0;l<a.length;l++)c.push("invalid property: "+a[l]);if(c.length>1)throw new Error("error creating Attribute: multiple errors");if(c.length)throw new Error("error creating Attribute: "+c[0]);this._eventListeners=[],this._errorConditions={}}function r(t){if(!1==this instanceof r)throw new Error("new operator required");var e;"function"==typeof t&&(t={type:"Function",contents:t}),t instanceof h&&(t={type:"Procedure",contents:t});var o=P(t=t||{},["name","description","type","contents","scope","timeout","theme","icon","bucket","presentationMode","location","images"]),i=[];for(e=0;e<o.length;e++)i.push("invalid property: "+o[e]);if(i.length>1)throw new Error("error creating Command: multiple errors");if(i.length)throw new Error("error creating Command: "+i[0]);for(e in t)this[e]=t[e];if(this.name=this.name||"a command","string"!=typeof this.name)throw new Error("name must be string");if(void 0===this.description&&(this.description=this.name+" Command"),void 0===this.type&&(this.type="Stub"),!k(r.getTypes(),this.type))throw new Error("Invalid command type: "+this.type);switch(this.type){case"Stub":break;case"Menu":if(!(this.contents instanceof Array))throw new Error("contents must be array of menu items");if(!this.contents.length)throw new Error("contents must be array of menu items");for(e in this.contents)if(this.contents.hasOwnProperty(e)&&"string"!=typeof this.contents[e]&&!(this.contents[e]instanceof r))throw new Error("contents must be array of menu items");break;case"Presentation":if(!(this.contents instanceof v))throw new Error("contents must be a Presentation");if(this.presentationMode=this.presentationMode||"View",!k(r.getPresentationModes(),this.presentationMode))throw new Error("Invalid presentationMode: "+this.presentationMode);break;case"Function":if("function"!=typeof this.contents)throw new Error("contents must be a Function");break;case"Procedure":if(!(this.contents instanceof h))throw new Error("contents must be a Procedure");break;default:throw new TypeError}if(void 0!==this.scope&&!(this.scope instanceof a||this.scope instanceof n))throw new Error("optional scope property must be Model or List");if(void 0!==this.timeout&&"number"!=typeof this.timeout)throw new Error("timeout must be a Number");if(void 0!==this.timeout&&"number"!=typeof this.timeout)throw new Error("timeout must be a Number");if(void 0!==this.theme){if("string"!=typeof this.theme)throw new Error("invalid theme");if(!k(["default","primary","success","info","warning","danger","link"],this.theme))throw new Error("invalid theme")}if(void 0!==this.icon){if("string"!=typeof this.icon)throw new Error("invalid icon");if(!k(["fa","glyphicon"],this.icon.split("-")[0])||!this.icon.split("-")[1])throw new Error("invalid icon")}this._eventListeners=[]}function o(t){if(!1==this instanceof o)throw new Error("new operator required");if(!1==t instanceof e.ModelID)throw new Error("Attribute.ModelID required in constructor");this.dateCreated=new Date,this.modelID=t,this.attributeValues={}}function i(t){if(!1==this instanceof i)throw new Error("new operator required");var e;(t=t||{}).name=t.name||"(unnamed)",t.description=t.description||"a Interface",t.vendor=t.vendor||null;var r=P(t,["name","description","vendor"]),o=[];for(e=0;e<r.length;e++)o.push("invalid property: "+r[e]);if(o.length>1)throw new Error("error creating Interface: multiple errors");if(o.length)throw new Error("error creating Interface: "+o[0]);for(e in this.startcallback=null,this.stopcallback=null,this.mocks=[],this.mockPending=!1,t)this[e]=t[e]}e.ModelID=function(t){if(!1==this instanceof e.ModelID)throw new Error("new operator required");if(!1==t instanceof a)throw new Error("must be constructed with Model");var r=t.getShortName();r&&(this.name=r),this.value=t.get("id"),this.constructorFunction=t.constructor,this.modelType=t.modelType},e.ModelID.prototype.toString=function(){return this.name?this.modelType+" "+this.name:this.modelType+" "+this.value},e.prototype.toString=function(){return null===this.name?"new Attribute":"Attribute: "+this.name+" = "+this.value},e.prototype.onEvent=function(t,e){if(!(t instanceof Array)){if("string"!=typeof t)throw new Error("subscription string or array required");t=[t]}if("function"!=typeof e)throw new Error("callback is required");for(var r in t)if(t.hasOwnProperty(r)&&"*"!=t[r]&&!k(["StateChange","Validate"],t[r]))throw new Error("Unknown command event: "+t[r]);return this._eventListeners.push({events:t,callback:e}),this},e.prototype.offEvent=function(){this._eventListeners=[]},e.prototype._emitEvent=function(t){var e;for(e in this._eventListeners)if(this._eventListeners.hasOwnProperty(e)){var r=this._eventListeners[e];(r.events.length&&"*"===r.events[0]||k(r.events,t))&&r.callback.call(this,t)}},e.prototype.get=function(){return this.value},e.prototype.set=function(t){switch(this.type){case"Model":if(!(t instanceof e.ModelID))throw new Error("set error: value must be Attribute.ModelID");this.value=t;break;default:this.value=t}return this._emitEvent("StateChange"),this.value},e.prototype.coerce=function(t){var e,r=t;switch(this.type){case"String":return void 0===r?"":"boolean"!=typeof r||r?r?(r=t.toString()).length>this.size?r.substring(0,this.size):r:"":"false";case"Number":return void 0===r?0:r?("string"==typeof r?(r=(e=(r=r.replace(/^\s+|\s+$/g,"")).split(" ")).length?e[0]:"",r=Number(r.replace(/[^/0-9\ \.]+/g,""))):r=Number(r),r||0):0;case"Boolean":return void 0!==r&&("string"==typeof r?"Y"===(r=r.toUpperCase())||"YES"===r||"T"===r||"TRUE"===r||"1"===r:!!r);case"Date":return"string"==typeof r&&2==r.split("/").length&&(r=r+"/"+(new Date).getFullYear()),new Date(r)}throw Error("coerce cannot determine appropriate value")},e.prototype.getObjectStateErrors=function(){var t;switch(this.validationErrors=[],this.name||this.validationErrors.push("name required"),k(["ID","String","Date","Boolean","Number","Model","Group","Table","Object"],this.type)||this.validationErrors.push("Invalid type: "+this.type),this.type){case"ID":break;case"String":"number"!=typeof this.size&&this.validationErrors.push("size must be a number from 1 to 255"),(this.size<1||this.size>255)&&this.validationErrors.push("size must be a number from 1 to 255"),null!==this.value&&"string"!=typeof this.value&&this.validationErrors.push("value must be null or a String");break;case"Date":null===this.value||this.value instanceof Date||this.validationErrors.push("value must be null or a Date");break;case"Boolean":null!==this.value&&"boolean"!=typeof this.value&&this.validationErrors.push("value must be null or a Boolean");break;case"Number":null!==this.value&&"number"!=typeof this.value&&this.validationErrors.push("value must be null or a Number");break;case"Model":this.value instanceof e.ModelID||this.validationErrors.push("value must be Attribute.ModelID");break;case"Group":if(null===this.value||this.value instanceof Array)for(t in this.value)this.value.hasOwnProperty(t)&&(this.value[t]instanceof e||this.validationErrors.push("each element in group must be instance of Attribute"),this.value[t].getObjectStateErrors().length&&this.validationErrors.push("group contains invalid members"));else this.validationErrors.push("value must be null or an array");break;case"Table":if(this.group instanceof e)if(this.group.value instanceof Array)if(this.group.value.length<1)this.validationErrors.push("group property value must contain at least one Attribute");else for(t in this.group.value)this.group.value.hasOwnProperty(t)&&(this.group.value[t]instanceof e||this.validationErrors.push("each element in group must be instance of Attribute"),this.group.value[t].getObjectStateErrors().length&&this.validationErrors.push("group contains invalid members"));else this.validationErrors.push("group.value must be an array");else this.validationErrors.push("group property required")}var r=P(this.validationRule,["required","range","isOneOf","isValidModel"]);return r.length&&this.validationErrors.push("invalid validationRule: "+r),this.validationMessage=this.validationErrors.length>0?this.validationErrors[0]:"",this.validationErrors},e.prototype.validate=function(t){if("function"!=typeof t)throw new Error("callback is required");var e;for(e in this.getObjectStateErrors(),this._emitEvent("Validate"),this._errorConditions)this._errorConditions.hasOwnProperty(e)&&this.validationErrors.push(this._errorConditions[e]);this.validationRule.required&&!this.value&&("Number"==this.type?0!==this.value&&this.validationErrors.push(this.label+" required"):"Boolean"==this.type?!1!==this.value&&this.validationErrors.push(this.label+" required"):this.validationErrors.push(this.label+" required")),this.validationRule.range&&(this.validationRule.range instanceof Array||(this.validationRule.range=[this.validationRule.range]),(this.validationRule.range[0]||0===this.validationRule.range[0])&&this.value<this.validationRule.range[0]&&this.validationErrors.push(this.label+" must be at least "+this.validationRule.range[0]),(this.validationRule.range[1]||0===this.validationRule.range[1])&&this.value>this.validationRule.range[1]&&this.validationErrors.push(this.label+" must be no more than "+this.validationRule.range[1])),this.validationRule.isOneOf&&(this.validationRule.isOneOf instanceof Array||(this.validationRule.isOneOf=[this.validationRule.isOneOf]),-1==this.validationRule.isOneOf.indexOf(this.value)&&this.validationErrors.push(this.label+" invalid")),this.validationMessage=this.validationErrors.length>0?this.validationErrors[0]:"",this._emitEvent("StateChange"),t.call(this)},e.prototype.setError=function(t,e){if(t=t||"",e=e||"",!t)throw new Error("condition required");if(!e)throw new Error("description required");this._errorConditions[t]=e},e.prototype.clearError=function(t){if(!(t=t||""))throw new Error("condition required");delete this._errorConditions[t]},e.getTypes=function(){return["ID","String","Date","Boolean","Number","Model","Group","Table","Object"].slice(0)},e.getEvents=function(){return["StateChange","Validate"].slice(0)},r.prototype.toString=function(){return this.type+" Command: "+this.name},r.prototype.onEvent=function(t,e){if(!(t instanceof Array)){if("string"!=typeof t)throw new Error("subscription string or array required");t=[t]}if("function"!=typeof e)throw new Error("callback is required");for(var r in t)if(t.hasOwnProperty(r)&&"*"!=t[r]&&!k(["BeforeExecute","AfterExecute","Error","Aborted","Completed"],t[r]))throw new Error("Unknown command event: "+t[r]);this._eventListeners.push({events:t,callback:e})},r.prototype._emitEvent=function(t,e){var r;for(r in this._eventListeners)if(this._eventListeners.hasOwnProperty(r)){var o=this._eventListeners[r];(o.events.length&&"*"===o.events[0]||k(o.events,t))&&o.callback.call(this,t,e)}},r.prototype.execute=function(t){var e,o=this,n=arguments;if(!o.type)throw new Error("command not implemented");if(!k(["Function","Procedure","Menu","Presentation"],o.type))throw new Error("command type "+o.type+" not implemented");switch(o.type){case"Presentation":if(!(o.contents instanceof v))throw new Error("contents must be a Presentation");if((e=o.contents.getObjectStateErrors()).length)throw e.length>1?new Error("error executing Presentation: multiple errors"):new Error("error executing Presentation: "+e[0]);if(!(t instanceof i))throw new Error("interface param required")}o._emitEvent("BeforeExecute");try{switch(o.type){case"Function":setTimeout(function(){o.status=0;try{o.contents.apply(o,n)}catch(t){o.error=t,o._emitEvent("Error",t),o._emitEvent("Completed"),o.status=-1}},0);break;case"Procedure":setTimeout(function(){o.status=0;for(var t=o.contents.tasks||[],e=0;e<t.length;e++){if("function"==typeof t[e]){var i=t[e];t[e]={requires:[-1],command:new r({type:"Function",contents:i})}}t[e].command._parentProcedure||(t[e].command._taskIndex=e,t[e].command._parentProcedure=o,t[e].command.onEvent("*",a)),t[e].command.status=void 0}s()},0);break;case"Menu":t.render(o,"View");break;case"Presentation":o.contents.preRenderCallback?o.contents.preRenderCallback(o,function(){t.render(o)}):t.render(o)}}catch(t){o.error=t,o._emitEvent("Error",t),o._emitEvent("Completed"),o.status=-1}function s(){for(var t=o.contents.tasks||[],e=0;e<t.length;e++){var r=!0;if(void 0===t[e].command.status){for(var i in t[e].requires){if("string"==typeof t[e].requires[i])for(var n=0;n<t.length;n++)t[n].label==t[e].requires[i]&&(!t[n].command.status||t[n].command.status<=0)&&(r=!1);if("number"==typeof t[e].requires[i])if(-1==t[e].requires[i])"0"!=e&&(!t[e-1].command.status||t[e-1].command.status<=0)&&(r=!1);else{var s=t[e].requires[i];(!t[s].command.status||t[s].command.status<=0)&&(r=!1)}}r&&t[e].command.execute()}}}function a(t,e){var r=o.contents.tasks,i=!0;switch(t){case"Error":o._emitEvent("Error",e);break;case"Aborted":o.abort();break;case"Completed":for(var n in r)r.hasOwnProperty(n)&&(r[n].command.status&&0!==r[n].command.status||(i=!1));i?o.complete():s()}}o._emitEvent("AfterExecute")},r.prototype.abort=function(){this._emitEvent("Aborted"),this.status=-1,this._emitEvent("Completed")},r.prototype.complete=function(){this.status=1,this._emitEvent("Completed")},r.prototype.restart=function(){this.status=void 0,this._emitEvent("Restarted"),this.execute()},r.getTypes=function(){return["Stub","Menu","Presentation","Function","Procedure"].slice(0)},r.getEvents=function(){return["BeforeExecute","AfterExecute","Error","Aborted","Completed"].slice(0)},r.getPresentationModes=function(){return["View","Edit","List"].slice(0)},i.prototype.toString=function(){return this.description},i.prototype.canMock=function(){return!0},i.prototype.doMock=function(){var t,e;if(this.mockPending=!1,!(this.mocks.length<1)){var r=this.mocks.shift();if("ok"!=r.type)if("yes"!=r.type&&"no"!=r.type&&"cancel"!=r.type)if("ask"!=r.type)if("choose"!=r.type){this.dispatch(r),this.mockPending=!0;var o=this;setTimeout(function(){o.doMock()},0)}else this.choosecallback?(t=this.choosecallback,delete this.choosecallback,t(i.firstMatch(r.value,this.chooseChoices))):(this.choosePending=!0,this.chooseResponse=r.value);else this.askcallback?(t=this.askcallback,delete this.askcallback,t(r.value)):(this.askPending=!0,this.askResponse=r.value);else{switch(r.type){case"yes":e=!0;break;case"no":e=!1;break;case"cancel":e=void 0}this.yesnocallback?(t=this.yesnocallback,delete this.yesnocallback,t(e)):(this.yesnoPending=!0,this.yesnoResponse=e)}else this.okcallback?(t=this.okcallback,delete this.okcallback,t()):this.okPending=!0}},i.prototype.mockRequest=function(t){if(!(t instanceof Array||t instanceof c))throw new Error("missing request parameter");var e;for(t instanceof Array||(t=[t]),e=0;e<t.length;e++)if(!1==t[e]instanceof c)throw new Error("invalid request parameter");for(e=0;e<t.length;e++)this.mocks.push(t[e]);this.mockPending||this.doMock()},i.prototype.start=function(t,e,r){if(!(t instanceof w))throw new Error("Application required");if(!(e instanceof v))throw new Error("presentation required");if("function"!=typeof r)throw new Error("callback required");this.application=t,this.presentation=e,this.startcallback=r},i.prototype.stop=function(t){if("function"!=typeof t)throw new Error("callback required")},i.prototype.dispatch=function(t,e){if(!1==t instanceof c)throw new Error("Request required");if(e&&"function"!=typeof e)throw new Error("response callback is not a function");this.application&&this.application.dispatch(t)||this.startcallback&&this.startcallback(t)},i.prototype.notify=function(t){if(!1==t instanceof s)throw new Error("Message required")},i.prototype.render=function(t,e){if(!1==t instanceof r)throw new Error("Command object required")},i.prototype.info=function(t){if(!t||"string"!=typeof t)throw new Error("text required")},i.prototype.done=function(t){if(!t||"string"!=typeof t)throw new Error("text required")},i.prototype.warn=function(t){if(!t||"string"!=typeof t)throw new Error("text required")},i.prototype.err=function(t){if(!t||"string"!=typeof t)throw new Error("text required")},i.prototype.ok=function(t,e){if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof e)throw new Error("callback required");this.okPending?(delete this.okPending,e()):this.okcallback=e},i.prototype.yesno=function(t,e){if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof e)throw new Error("callback required");this.yesnoPending?(delete this.yesnoPending,e(this.yesnoResponse)):this.yesnocallback=e},i.prototype.ask=function(t,r,o){if(!t||"string"!=typeof t)throw new Error("prompt required");if(!1==r instanceof e)throw new Error("attribute or callback expected");if("function"!=typeof o)throw new Error("callback required");this.askPending?(delete this.askPending,o(this.askResponse)):this.askcallback=o},i.prototype.choose=function(t,e,r){if(!t||"string"!=typeof t)throw new Error("prompt required");if(!1==e instanceof Array)throw new Error("choices array required");if(!e.length)throw new Error("choices array empty");if("function"!=typeof r)throw new Error("callback required");this.choosePending?(delete this.choosePending,r(i.firstMatch(this.chooseResponse,e))):(this.choosecallback=r,this.chooseChoices=e)},i.firstMatch=function(t,e){if(void 0!==t)for(var r=0;r<e.length;r++){var o=e[r].toLowerCase();if(S(o,t.length)==t.toLowerCase())return r}};var n=function(t){if(!1==this instanceof n)throw new Error("new operator required");if(t instanceof a)this.model=t;else{if(!(t instanceof f))throw new Error("argument required: model");this.view=t,this.model=this.view.primaryModel}this.attributes=t.attributes,this._items=[],this._itemIndex=-1};function s(t,e){if(!1==this instanceof s)throw new Error("new operator required");if(void 0===t)throw new Error("message type required");if(!k(s.getTypes(),t))throw new Error("Invalid message type: "+t);this.type=t,this.contents=e}n.prototype.length=function(){return this._items.length},n.prototype.clear=function(){return this._items=[],this._itemIndex=-1,this},n.prototype.get=function(t){if(this._items.length<1)throw new Error("list is empty");for(var e=0;e<this.attributes.length;e++){var r=this.attributes[e].name.toUpperCase(),o=t.toUpperCase(),i=o.split("."),n=r==o;if(2==i.length){o=i[1];var s=i[0],a=this.attributes[e].model.modelType.toUpperCase();n=r==o&&s==a}if(n)return"Date"!=this.attributes[e].type||this._items[this._itemIndex][e]instanceof Date?this._items[this._itemIndex][e]:null===this._items[this._itemIndex][e]||void 0===this._items[this._itemIndex][e]?null:new Date(this._items[this._itemIndex][e])}},n.prototype.set=function(t,e){if(this._items.length<1)throw new Error("list is empty");for(var r=0;r<this.attributes.length;r++){var o=this.attributes[r].name.toUpperCase(),i=t.toUpperCase(),n=i.split("."),s=o==i;if(2==n.length){i=n[1];var a=n[0],h=this.attributes[r].model.modelType.toUpperCase();s=o==i&&a==h}if(s)return void(this._items[this._itemIndex][r]=e)}throw new Error("attribute not valid for list model")},n.prototype.addItem=function(t){var e,r=[];if(t)for(e in t.attributes)r.push(t.attributes[e].value);else for(e in this.attributes)r.push(void 0);return this._items.push(r),this._itemIndex=this._items.length-1,this},n.prototype.removeItem=function(){return this._items.splice(this._itemIndex,1),this._itemIndex--,this},n.prototype.findItemByID=function(t){for(var e=this.moveFirst();e;){if(t==this._items[this._itemIndex][0])return!0;e=this.moveNext()}return!1},n.prototype.indexedItem=function(t){return!(this._items.length<1)&&(!(t<0)&&(!(t>=this._items.length)&&(this._itemIndex=t,!0)))},n.prototype.moveNext=function(){return!(this._items.length<1)&&this.indexedItem(this._itemIndex+1)},n.prototype.movePrevious=function(){return!(this._items.length<1)&&this.indexedItem(this._itemIndex-1)},n.prototype.moveFirst=function(){return!(this._items.length<1)&&this.indexedItem(0)},n.prototype.moveLast=function(){return!(this._items.length<1)&&this.indexedItem(this._items.length-1)},n.prototype.sort=function(t){var e,r=0;for(var o in t)e||(e=o);if(!e)throw new Error("sort order required");for(var i=1==t[e];r<this.attributes.length&&this.attributes[r].name!=e;)r++;this._items.sort(function(t,e){if(i){if(t[r]<e[r])return-1;if(t[r]>e[r])return 1}else{if(t[r]>e[r])return-1;if(t[r]<e[r])return 1}return 0})},s.prototype.toString=function(){switch(this.type){case"Null":return this.type+" Message";default:return this.type+" Message: "+this.contents}},s.getTypes=function(){return["Null","Connected","Error","Sent","Ping","PutModel","PutModelAck","GetModel","GetModelAck","DeleteModel","DeleteModelAck","GetList","GetListAck"].slice(0)};var a=function(t){var r;if(!1==this instanceof a)throw new Error("new operator required");if(this.attributes=[new e("id","ID")],t=t||{},this.modelType=t.modelType||"Model",t.attributes)for(r in t.attributes)t.attributes.hasOwnProperty(r)&&this.attributes.push(t.attributes[r]);var o=P(t,["modelType","attributes"]),i=this.getObjectStateErrors();for(r=0;r<o.length;r++)i.push("invalid property: "+o[r]);if(i.length>1)throw new Error("error creating Model: multiple errors");if(i.length)throw new Error("error creating Model: "+i[0]);for(this._eventListeners=[],this._errorConditions={},r=0;r<this.attributes.length;r++)this.attributes[r].model=this};a._ModelConstructor={},a.prototype.toString=function(){return"a "+this.modelType},a.prototype.copy=function(t){for(var e=0;e<this.attributes.length;e++)this.attributes[e].value=t.attributes[e].value},a.prototype.getObjectStateErrors=function(){if(this.validationErrors=[],this.attributes instanceof Array)if(this.attributes.length<1)this.validationErrors.push("attributes must not be empty");else for(var t=0;t<this.attributes.length;t++)0!==t||this.attributes[t]instanceof e&&"ID"==this.attributes[t].type||this.validationErrors.push("first attribute must be ID"),this.attributes[t]instanceof e||this.validationErrors.push("attribute must be Attribute");else this.validationErrors.push("attributes must be Array");return void 0===this.tags||this.tags instanceof Array||this.validationErrors.push("tags must be Array or null"),this.validationErrors},a.prototype.attribute=function(t){for(var e=0;e<this.attributes.length;e++)if(this.attributes[e].name.toUpperCase()==t.toUpperCase())return this.attributes[e];throw new Error("attribute not found in model: "+t)},a.prototype.get=function(t){for(var e=0;e<this.attributes.length;e++)if(this.attributes[e].name.toUpperCase()==t.toUpperCase())return this.attributes[e].get()},a.prototype.getShortName=function(){for(var t=0;t<this.attributes.length;t++)if("String"==this.attributes[t].type)return this.attributes[t].get();return""},a.prototype.getLongName=function(){return this.getShortName()},a.prototype.getAttributeType=function(t){for(var e=0;e<this.attributes.length;e++)if(this.attributes[e].name.toUpperCase()==t.toUpperCase())return this.attributes[e].type},a.prototype.set=function(t,e){for(var r=0;r<this.attributes.length;r++)if(this.attributes[r].name.toUpperCase()==t.toUpperCase())return this.attributes[r].set(e),void this._emitEvent("StateChange");throw new Error("attribute not valid for model")},a.prototype.validate=function(t){var e,r,o=this,i=0;if("function"!=typeof t)throw new Error("callback is required");for(r in o.getObjectStateErrors(),o._errorConditions)o._errorConditions.hasOwnProperty(r)&&o.validationErrors.push(o._errorConditions[r]);if(o.validationErrors.length)return o.validationMessage=o.validationErrors.length>0?o.validationErrors[0]:"",o._emitEvent("StateChange"),void t.call(o);for(e=0;e<o.attributes.length;e++)i++,function(e){setTimeout(function(){e.validate(function(){e.validationErrors.length&&o.validationErrors.push("bush"),0==--i&&(o.validationErrors.length||o._emitEvent("Validate"),o.validationMessage=o.validationErrors.length>0?o.validationErrors[0]:"",o._emitEvent("StateChange"),t.call(o))})},0)}(o.attributes[e])},a.prototype.onEvent=function(t,e){if(!(t instanceof Array)){if("string"!=typeof t)throw new Error("subscription string or array required");t=[t]}if("function"!=typeof e)throw new Error("callback is required");for(var r in t)if(t.hasOwnProperty(r)&&"*"!=t[r]&&!k(["StateChange","Validate"],t[r]))throw new Error("Unknown command event: "+t[r]);return this._eventListeners.push({events:t,callback:e}),this},a.prototype._emitEvent=function(t,e){var r;for(r in this._eventListeners)if(this._eventListeners.hasOwnProperty(r)){var o=this._eventListeners[r];(o.events.length&&"*"===o.events[0]||k(o.events,t))&&o.callback.call(this,t,e)}},a.prototype.setError=function(t,e){if(t=t||"",e=e||"",!t)throw new Error("condition required");if(!e)throw new Error("description required");this._errorConditions[t]=e},a.prototype.clearError=function(t){if(!(t=t||""))throw new Error("condition required");delete this._errorConditions[t]};var h=function(t){if(!1==this instanceof h)throw new Error("new operator required");var e;t instanceof Array&&(t={tasks:t});var r=P(t=t||{},["tasks","tasksNeeded","tasksCompleted"]),o=[];for(e=0;e<r.length;e++)o.push("invalid property: "+r[e]);if(o.length>1)throw new Error("error creating Procedure: multiple errors");if(o.length)throw new Error("error creating Procedure: "+o[0]);for(e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);if(o=this.getObjectStateErrors()){if(o.length>1)throw new Error("error creating Procedure: multiple errors");if(o.length)throw new Error("error creating Procedure: "+o[0])}};function c(t){if(!1==this instanceof c)throw new Error("new operator required");if("string"==typeof t){var e=t;(t={}).type=e}if(t=t||{},this.type=t.type||null,t.value&&(this.value=t.value),!this.type||"string"!=typeof this.type)throw new Error("Request type required");switch(this.type){case"Command":if(this.command=t.command||null,!(this.command instanceof r))throw new Error("command object required")}}h.prototype.getObjectStateErrors=function(){var t,e,o,i;if(this.tasks&&!(this.tasks instanceof Array))return["tasks is not an array"];var n=[];for(t in this.tasks)if(this.tasks.hasOwnProperty(t)){var s=this.tasks[t];for(i=P(s,["label","command","requires","timeout"]),e=0;e<i.length;e++)n.push("invalid task["+t+"] property: "+i[e]);for(e in void 0!==s.label&&"string"!=typeof s.label&&n.push("task["+t+"].label must be string"),void 0===s.command||s.command instanceof r||n.push("task["+t+"].command must be a Command object"),void 0===s.requires&&(s.requires=-1),s.requires instanceof Array||(s.requires=[s.requires]),s.requires)if(s.requires.hasOwnProperty(e)&&null!==s.requires[e])switch(typeof s.requires[e]){case"string":var a=!1;for(o=0;!a&&o<this.tasks.length;o++)s.requires[e]==this.tasks[o].label&&(a=!0);if(!a)throw new Error("missing label: "+s.requires[e]);break;case"number":if(s.requires[e]>=this.tasks.length)throw new Error("missing task #"+s.requires[e]+" for requires in task["+t+"]");if(s.requires[e]<-1)throw new Error("task #"+s.requires[e]+" invalid requires in task["+t+"]");break;default:throw new Error("invalid type for requires in task["+t+"]")}}return n.length?n:null},c.prototype.toString=function(){switch(this.type){case"Command":return this.type+" Request: "+this.command;default:return this.type+" Request"}};var l=function(t){if(!1==this instanceof l)throw new Error("new operator required");t=t||{},this.storeType=t.storeType||"Store",this.name=t.name||"a "+this.storeType,this.storeProperty={isReady:!1,canGetModel:!1,canPutModel:!1,canDeleteModel:!1,canGetList:!1};for(var e=P(t,["name","storeType"]),r=[],o=0;o<e.length;o++)r.push("invalid property: "+e[o]);if(r.length>1)throw new Error("error creating Store: multiple errors");if(r.length)throw new Error("error creating Store: "+r[0])};function u(t){if(!1==this instanceof u)throw new Error("new operator required");this.contents=t||"",this._eventListeners=[]}function p(t,e){if(!1==this instanceof p)throw new Error("new operator required");if("string"!=typeof t)throw new Error("argument must a url string");if("function"!=typeof e)throw new Error("argument must a callback");var r=this;r.connected=!1,r.initialConnect=!0,r.location=t,""===r.location&&(r.location="http host"),r.socket=io.connect(t,{reconnection:!1}),r.socket.on("connect",function(){r.connected=!0,r.initialConnect=!1,console.log("socket.io ("+r.location+") connected"),e.call(r,new s("Connected",""))}),r.socket.on("connecting",function(){console.log("socket.io ("+r.location+") connecting")}),r.socket.on("error",function(t){var o="general error with "+r.location+(t?", reason "+t:"");console.error(o),r.initialConnect&&e.call(r,new s("Error",o))}),r.socket.on("connect_error",function(t){var o="connect error with "+r.location+(t?", reason "+t:"");console.error(o),r.initialConnect&&e.call(r,new s("Error",o))}),r.socket.on("connect_failed",function(t){var o="connect failed with "+r.location+(t?", reason "+t:"");console.error(o),r.initialConnect&&e.call(r,new s("Error",o))}),r.socket.on("message",function(t){r.rawCallBack?r.rawCallBack(t):console.log("socket.io ("+r.location+") message: "+t)}),r.socket.on("disconnect",function(t){r.connected=!1,console.log("socket.io ("+r.location+") disconnect: "+t)})}function f(t,r,o){if(!1==this instanceof f)throw new Error("new operator required");if(!(t instanceof a))throw new Error("argument must be a Model");if("object"!=typeof r)throw new Error("object expected");if(!(o instanceof Array))throw new Error("array of attributes expected");this.primaryModel=t,this.relatedModels=r,this.attributes=o;var i=new e("id","ID");for(var n in i.model=t,this.attributes.unshift(i),r)if(r.hasOwnProperty(n)){var s=r[n];if("object"!=typeof s)throw new Error("relatedModel key values expect object");if(void 0===s.id)throw new Error("relatedModel key values expect object with id key");if(void 0===s.model)throw new Error("relatedModel key values expect object with model key");if(!(s.id instanceof e))throw new Error("relatedModel id must be a Attribute");if(!(s.model instanceof a))throw new Error("relatedModel model must be a Model")}for(var h=0;h<o.length;h++){var c=o[h];if(!(c instanceof e))throw new Error("attribute array must contain Attributes");if(!(c.model instanceof a))throw new Error("attribute array must contain Attributes with model references")}}l.prototype.toString=function(){return this.name=="a "+this.storeType?this.name:this.storeType+": "+this.name},l.prototype.getServices=function(){return this.storeProperty},l.prototype.onConnect=function(t,e){if("string"!=typeof t)throw new Error("argument must a url string");if("function"!=typeof e)throw new Error("argument must a callback");e(this,void 0)},l.prototype.getModel=function(){throw new Error(this.storeType+" does not provide getModel")},l.prototype.putModel=function(){throw new Error("Store does not provide putModel")},l.prototype.deleteModel=function(){throw new Error("Store does not provide deleteModel")},l.prototype.getList=function(){throw new Error("Store does not provide getList")},l.prototype.getViewList=function(t,e,r,o){var i,s,a,h=this;if("function"==typeof o?(i=o,s=r):i=r,!(t instanceof n))throw new Error("argument must be a List");if(!t.view)throw new Error("List is Model type use getList");if(!(e instanceof Object))throw new Error("filter argument must be Object");if("function"!=typeof i)throw new Error("callback required");var c=new n(t.model);function l(e,r){if(t.clear(),void 0===r){var o=c.moveFirst(),n=[];s()}else i(t,r);function s(){if(o){for(t.addItem(),a=0;a<t.attributes.length;a++){var e=t.attributes[a];e.model==t.model&&t.set(e.name,c.get(e.name))}for(var r in n=[],t.view.relatedModels)t.view.relatedModels.hasOwnProperty(r)&&n.push(r);!function e(){if(!n.length)return o=c.moveNext(),void s();var r=n.shift();var a=t.view.relatedModels[r];var l=c.get(a.id.name);a.model.set("id",l);h.getModel(a.model,function(r,o){if(void 0===o){for(var n=0;n<t.attributes.length;n++){var s=t.attributes[n];s.model==r&&t.set(r.modelType+"."+s.name,r.get(s.name))}e()}else i(o)})}()}else i(t)}}s?this.getList(c,e,s,l):this.getList(c,e,l)},u.prototype.toString=function(){return"Text: '"+(this.contents||"")+"'"},u.prototype.get=function(){return this.contents},u.prototype.set=function(t){return this.contents=t,this._emitEvent("StateChange"),this.contents},u.prototype._emitEvent=function(t){var e;for(e in this._eventListeners)if(this._eventListeners.hasOwnProperty(e)){var r=this._eventListeners[e];(r.events.length&&"*"===r.events[0]||k(r.events,t))&&r.callback.call(this,t)}},u.prototype.onEvent=function(t,e){if(!(t instanceof Array)){if("string"!=typeof t)throw new Error("subscription string or array required");t=[t]}if("function"!=typeof e)throw new Error("callback is required");for(var r in t)if(t.hasOwnProperty(r)&&"*"!=t[r]&&!k(["StateChange"],t[r]))throw new Error("Unknown command event: "+t[r]);return this._eventListeners.push({events:t,callback:e}),this},u.prototype.offEvent=function(){this._eventListeners=[]},p.showLog=!1,p.messageHandlers={},p.setMessageHandler=function(t,e){p.messageHandlers[t]=e},p.hostMessageProcess=function(t,e){p.showLog&&console.log("Transport.hostMessageProcess "+JSON.stringify(t)),p.messageHandlers[t.type]?p.messageHandlers[t.type](t.contents,e):e(!0)},p.prototype.sendRaw=function(t){this.socket.send(t)},p.prototype.onRaw=function(t){this.rawCallBack=t},p.prototype.send=function(t,e){var r=this;if(void 0===t)throw new Error("message required");if(!(t instanceof s))throw new Error("parameter must be instance of Message");if(void 0!==e&&"function"!=typeof e)throw new Error("argument must a callback");this.connected?void 0!==e?(p.showLog&&console.log("Transport emit "+JSON.stringify(t)),r.socket.emit("ackmessage",t,function(t){e.call(r,t)})):(p.showLog&&console.log("Transport send "+JSON.stringify(t)),r.socket.send(t)):e.call(r,new s("Error","not connected"))},p.prototype.close=function(){if(!this.connected)throw new Error("not connected");this.socket.disconnect()},f.prototype.toString=function(){return this.primaryModel+" View"};var d=function(t){if(!1==this instanceof i)throw new Error("new operator required");var e;(t=t||{}).name=t.name||"(unnamed)",t.description=t.description||"a REPLInterface",t.vendor=t.vendor||null;var r=P(t,["name","description","vendor"]),o=[];for(e=0;e<r.length;e++)o.push("invalid property: "+r[e]);if(o.length>1)throw new Error("error creating Interface: multiple errors");if(o.length)throw new Error("error creating Interface: "+o[0]);for(e in this.startcallback=null,this.stopcallback=null,this.mocks=[],this.mockPending=!1,this.navStack=[],t)this[e]=t[e]};d.prototype=Object.create(i.prototype),d.prototype.toString=function(){return this.description},d.prototype.canMock=function(){return!0},d.prototype.doMock=function(){var t,e;if(this.mockPending=!1,!(this.mocks.length<1)){var r=this.mocks.shift();if("ok"!=r.type)if("yes"!=r.type&&"no"!=r.type&&"cancel"!=r.type)if("ask"!=r.type)if("choose"!=r.type){this.dispatch(r),this.mockPending=!0;var o=this;setTimeout(function(){o.doMock()},0)}else this.choosecallback?(t=this.choosecallback,delete this.choosecallback,t(i.firstMatch(r.value,this.chooseChoices))):(this.choosePending=!0,this.chooseResponse=r.value);else this.askcallback?(t=this.askcallback,delete this.askcallback,t(r.value)):(this.askPending=!0,this.askResponse=r.value);else{switch(r.type){case"yes":e=!0;break;case"no":e=!1;break;case"cancel":e=void 0}this.yesnocallback?(t=this.yesnocallback,delete this.yesnocallback,t(e)):(this.yesnoPending=!0,this.yesnoResponse=e)}else this.okcallback?(t=this.okcallback,delete this.okcallback,t()):this.okPending=!0}},d.prototype.mockRequest=function(t){if(!(t instanceof Array||t instanceof c))throw new Error("missing request parameter");var e;for(t instanceof Array||(t=[t]),e=0;e<t.length;e++)if(!1==t[e]instanceof c)throw new Error("invalid request parameter");for(e=0;e<t.length;e++)this.mocks.push(t[e]);this.mockPending||this.doMock()},d.prototype.start=function(t,e,r){if(!(t instanceof w))throw new Error("Application required");if(!(e instanceof v))throw new Error("presentation required");if("function"!=typeof r)throw new Error("callback required");this.application=t,this.presentation=e,this.startcallback=r,this.evaluateInput()},d.prototype.stop=function(t){if("function"!=typeof t)throw new Error("callback required")},d.prototype.dispatch=function(t,e){if(!1==t instanceof c)throw new Error("Request required");if(e&&"function"!=typeof e)throw new Error("response callback is not a function");this.application&&this.application.dispatch(t)||this.startcallback&&this.startcallback(t)},d.prototype.notify=function(t){if(!1==t instanceof s)throw new Error("Message required");this._Output(t)},d.prototype.render=function(t,o,i){if(!1==t instanceof v)throw new Error("Presentation object required");if("string"!=typeof o)throw new Error("presentationMode required");if(!k(r.getPresentationModes(),o))throw new Error("Invalid presentationMode: "+o);if(i&&"function"!=typeof i)throw new Error("optional second argument must a commandRequest callback function");var n,s,a=t.get("contents"),h=0;switch(o){case"View":for(n=0;n<a.length;n++)a[n]instanceof e&&a[n].label.length>h&&(h=a[n].label.length);for(n=0;n<a.length;n++)(s=a[n])instanceof e?this._Output(L(s.label,h)+": "+s.value):this._Output(s);break;case"Edit":for(this.editPresentationContents=a.slice();this.editPresentationContents.length&&!(this.editPresentationContents[0]instanceof e);){var c=this.editPresentationContents.shift();c instanceof r||this._Output(c)}this.editPresentationContents.length&&this.editPresentationContents[0]instanceof e&&this._setPrompt(this.editPresentationContents[0].label+": "),this.editPresentationContents.length||delete this.editPresentationContents;break;default:throw new Error("presentationMode not handled: "+o)}},d.prototype.info=function(t){if(!t||"string"!=typeof t)throw new Error("text required");this._Output(t)},d.prototype.ok=function(t,e){if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof e)throw new Error("callback required");this._Output(t),this.okPending?(delete this.okPending,e()):this.okcallback=e},d.prototype.yesno=function(t,e){if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof e)throw new Error("callback required");this.yesnoPrompt=t,this._setPrompt(this.yesnoPrompt),this.yesnoPending?(delete this.yesnoPending,e(this.yesnoResponse)):this.yesnocallback=e},d.prototype.ask=function(t,r,o){if(!t||"string"!=typeof t)throw new Error("prompt required");if(!1==r instanceof e)throw new Error("attribute or callback expected");if("function"!=typeof o)throw new Error("callback required");this.askPrompt=t,this._setPrompt(t),this.askPending?(delete this.askPending,o(this.askResponse)):this.askcallback=o},d.prototype.choose=function(t,e,r){if(!t||"string"!=typeof t)throw new Error("prompt required");if(!1==e instanceof Array)throw new Error("choices array required");if(!e.length)throw new Error("choices array empty");if("function"!=typeof r)throw new Error("callback required");this.choosePrompt=t,this._Output(t);for(var o=0;o<e.length;o++)this._Output("  "+e[o]);this._setPrompt("Choice? "),this.choosePending?(delete this.choosePending,r(i.firstMatch(this.chooseResponse,e))):(this.choosecallback=r,this.chooseChoices=e)},d.prototype.evaluateInput=function(t){var e=this;void 0===t&&(t=""),this._evaluateInput(t),setTimeout(function(){var t=e.application?e.application.get("brand"):"?";!e.promptText&&e.application&&e.application.primaryInterface&&e._ShowNav(),e.promptText&&(t=e.promptText,delete e.promptText),e.capturePromptcallback&&e.capturePromptcallback(t)},10)},d.prototype._evaluateInput=function(t){var o,n,s,a=(""+t).toUpperCase();if(this.okcallback)return o=this.okcallback,delete this.okcallback,void o();if(this.yesnocallback)return"Y"==a||"YES"==a?(o=this.yesnocallback,delete this.yesnocallback,void o(!0)):"N"==a||"NO"==a?(o=this.yesnocallback,delete this.yesnocallback,void o(!1)):0===t.length?(o=this.yesnocallback,delete this.yesnocallback,void o()):(this._Output("yes or no response required"),void this._setPrompt(this.yesnoPrompt));if(this.askcallback)return o=this.askcallback,delete this.askcallback,void o(t);if(this.choosecallback){o=this.choosecallback;var h=i.firstMatch(t,this.chooseChoices);if(h)delete this.choosecallback,o(h);else if(t.length>0){for(this.application.info('"'+t+'" not valid'),this._Output(this.choosePrompt),n=0;n<this.chooseChoices.length;n++)this._Output("  "+this.chooseChoices[n]);this._setPrompt("Choice? ")}else delete this.choosecallback,o()}else{if(this.editPresentationContents){if(!(this.editPresentationContents.length&&this.editPresentationContents[0]instanceof e))throw this.editPresentationContents.length||delete this.editPresentationContents,new Error("editPresentationContents expected attribute");for(s=this.editPresentationContents.shift(),t.length&&(s.value=t);this.editPresentationContents.length&&!(this.editPresentationContents[0]instanceof e);)(s=this.editPresentationContents.shift())instanceof r||this._Output(s);return this.editPresentationContents.length&&this.editPresentationContents[0]instanceof e&&this._setPrompt(this.editPresentationContents[0].label+": "),void(this.editPresentationContents.length||delete this.editPresentationContents)}if(this.presentation){var c=this.presentation.get("contents");for(this.navStack.length>0&&(c=this.navStack[this.navStack.length-1].contents),n=0;n<c.length;n++){var l=c[n];if(l instanceof r){var u=l.name.toUpperCase();if(t.length&&S(u,a.length)==a){switch(l.type){case"Stub":this.info(l.description+" not available.");break;case"Menu":this.navStack.push(l);break;case"Presentation":l.presentationMode="Edit",l.execute(this);break;default:l.execute()}return}}}t.length>0?this.application.info('"'+t+'" not valid'):this.navStack.pop()}else this._Output("input ignored: "+t)}},d.prototype._ShowNav=function(){var t,e=this.application?this.application.get("brand"):"?",o=this.presentation.get("contents"),i="",n="",s="";if(this.navStack.length>0){var a=this.navStack[this.navStack.length-1];for(i=a.name.replace(/\s/g,"")+": ",o=a.contents,t=0;t<this.navStack.length;t++)e+=" / "+this.navStack[t].name.replace(/\s/g,"")}for(t=0;t<o.length;t++){var h=o[t];h instanceof r&&(n+=s+h.name.replace(/\s/g,""),s=", ")}this.application.info(i+n),this._setPrompt(e+">")},d.prototype.captureOutput=function(t){this.captureOutputcallback=t},d.prototype.capturePrompt=function(t){this.capturePromptcallback=t},d.prototype._setPrompt=function(t){this.promptText=t},d.prototype._Output=function(t){this.captureOutputcallback&&this.captureOutputcallback(t)};var w=function(t){if(!1==this instanceof w)throw new Error("new operator required");(t=t||{}).attributes||(t.attributes=[]),t.attributes.push(new e({name:"name",type:"String(20)"})),t.attributes.push(new e({name:"brand",type:"String"})),t.interface&&(this.setInterface(t.interface),delete t.interface),a.call(this,t),this.modelType="Application",this.set("name","newApp"),this.set("brand","NEW APP")};w.prototype=Object.create(a.prototype),a._ModelConstructor.Application=w,w.prototype.start=function(t){if(!1==this.primaryInterface instanceof i)throw new Error("error starting application: interface not set");if("function"!=typeof t)throw new Error("callback required");var e=this;this.startcallback=t,this.presentation||(this.presentation=new v),this.primaryInterface.start(e,this.presentation,function(t){"Command"==t.type?t.command.execute():e.startcallback&&e.startcallback(t)})},w.prototype.dispatch=function(t,e){if(!1==t instanceof c)throw new Error("Request required");if(e&&"function"!=typeof e)throw new Error("response callback is not a function");return"Command"==t.type?(t.command.execute(),!0):!!this.startcallback&&(this.startcallback(t),!0)},w.prototype.setInterface=function(t){if(!1==t instanceof i)throw new Error("instance of Interface a required parameter");this.primaryInterface=t},w.prototype.getInterface=function(){return this.primaryInterface},w.prototype.setPresentation=function(t){if(!1==t instanceof v)throw new Error("instance of Presentation a required parameter");this.presentation=t},w.prototype.getPresentation=function(){return this.presentation},w.prototype.info=function(t){if(!1==this.primaryInterface instanceof i)throw new Error("interface not set");if(!t||"string"!=typeof t)throw new Error("text parameter required");this.primaryInterface.info(t)},w.prototype.done=function(t){if(!1==this.primaryInterface instanceof i)throw new Error("interface not set");if(!t||"string"!=typeof t)throw new Error("text parameter required");this.primaryInterface.done(t)},w.prototype.warn=function(t){if(!1==this.primaryInterface instanceof i)throw new Error("interface not set");if(!t||"string"!=typeof t)throw new Error("text parameter required");this.primaryInterface.warn(t)},w.prototype.err=function(t){if(!1==this.primaryInterface instanceof i)throw new Error("interface not set");if(!t||"string"!=typeof t)throw new Error("text parameter required");this.primaryInterface.err(t)},w.prototype.ok=function(t,e){if(!1==this.primaryInterface instanceof i)throw new Error("interface not set");if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof e)throw new Error("callback required");this.primaryInterface.ok(t,e)},w.prototype.yesno=function(t,e){if(!1==this.primaryInterface instanceof i)throw new Error("interface not set");if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof e)throw new Error("callback required");this.primaryInterface.yesno(t,e)},w.prototype.ask=function(t,r,o){if(!1==this.primaryInterface instanceof i)throw new Error("interface not set");if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof r){if(!1==r instanceof e)throw new Error("attribute or callback expected");if("function"!=typeof o)throw new Error("callback required");this.primaryInterface.ask(t,r,o)}else this.primaryInterface.ask(t,new e({name:"default"}),r)},w.prototype.choose=function(t,e,r){if(!1==this.primaryInterface instanceof i)throw new Error("interface not set");if(!t||"string"!=typeof t)throw new Error("prompt required");if(!1==e instanceof Array)throw new Error("choices array required");if(!e.length)throw new Error("choices array empty");if("function"!=typeof r)throw new Error("callback required");this.primaryInterface.choose(t,e,r)};var m=function(t){if(!1==this instanceof m)throw new Error("new operator required");if("string"==typeof t){var r=t;(t={}).contents=r}(t=t||{}).attributes||(t.attributes=[]);var o=t.logType||"Text",i=t.importance||"Info",n=t.contents||"(no text)";if(!k(["Text","Delta"],o))throw new Error("Unknown log type: "+o);void 0!==t.logType&&delete t.logType,void 0!==t.importance&&delete t.importance,void 0!==t.contents&&delete t.contents,t.attributes.push(new e({name:"dateLogged",type:"Date",value:new Date})),t.attributes.push(new e({name:"logType",type:"String",value:o})),t.attributes.push(new e({name:"importance",type:"String",value:i})),"Delta"==o?t.attributes.push(new e({name:"contents",type:"Object",value:n})):t.attributes.push(new e({name:"contents",type:"String",value:n})),a.call(this,t),this.modelType="Log"};m.prototype=Object.create(a.prototype),a._ModelConstructor.Log=m,m.prototype.toString=function(){return"Delta"==this.get("logType")?this.get("importance")+": (delta)":this.get("importance")+": "+this.get("contents")};var v=function(t){if(!1==this instanceof v)throw new Error("new operator required");(t=t||{}).attributes||(t.attributes=[]),t.attributes.push(new e({name:"name",type:"String"})),t.attributes.push(new e({name:"modelName",type:"String"})),t.attributes.push(new e({name:"contents",type:"Object",value:[]})),a.call(this,t),this.modelType="Presentation"};v.prototype=Object.create(a.prototype),a._ModelConstructor.Presentation=v,v.prototype.getObjectStateErrors=function(t){var o;if(this.validationErrors=a.prototype.getObjectStateErrors.call(this),!t&&0===this.validationErrors.length){var i=this.get("contents"),s=!1;if(i instanceof Array){for(o=0;o<i.length;o++)i[o]instanceof u||i[o]instanceof r||i[o]instanceof e||i[o]instanceof n||"string"==typeof i[o]||(s=!0);s&&this.validationErrors.push("contents elements must be Text, Command, Attribute, List or string")}else this.validationErrors.push("contents must be Array")}return this.validationMessage=this.validationErrors.length>0?this.validationErrors[0]:"",this.validationErrors},v.prototype.validate=function(t){var r,o,i=this;if("function"!=typeof t)throw new Error("callback is required");for(r in this.getObjectStateErrors(),this._errorConditions)this._errorConditions.hasOwnProperty(r)&&this.validationErrors.push(this._errorConditions[r]);var n=!1,s=0,a=0,h=this.get("contents");for(h instanceof Array||(h=[]),o=0;o<h.length;o++)h[o]instanceof e&&s++;for(o=0;o<h.length;o++)h[o]instanceof e&&h[o].validate(c);function c(){a++,this.validationMessage&&(n=!0),s==a&&(n&&i.validationErrors.push("contents has validation errors"),l())}function l(){i.validationMessage=i.validationErrors.length>0?i.validationErrors[0]:"",t()}h.length<1&&l()};var y=function(t){if(!1==this instanceof y)throw new Error("new operator required");(t=t||{}).attributes||(t.attributes=[]);var r=new e.ModelID(new g);t.attributes.push(new e({name:"userID",type:"Model",value:r})),t.attributes.push(new e({name:"dateStarted",type:"Date",value:new Date})),t.attributes.push(new e({name:"passCode",type:"String(20)"})),t.attributes.push(new e({name:"active",type:"Boolean"})),t.attributes.push(new e({name:"ipAddress",type:"String"})),a.call(this,t),this.modelType="Session",this.set("active",!1)};y.prototype=Object.create(a.prototype),a._ModelConstructor.Session=y,y.prototype.startSession=function(t,r,o,i,s){if(!1==t instanceof l)throw new Error("store required");if("string"!=typeof r)throw new Error("userName required");if("string"!=typeof o)throw new Error("password required");if("string"!=typeof i)throw new Error("ip required");if("function"!=typeof s)throw new Error("callback required");var a=this,h=new g;t.getList(new n(h),{name:r,password:o},function(r,o){if(o)s(o);else if(1==r.length()){for(var n="",h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=0;c<20;c++)n+=h.charAt(Math.floor(Math.random()*h.length));r.moveFirst(),r.model.set("id",r.get("id")),r.model.set("name",r.get("name")),a.set("userID",new e.ModelID(r.model)),a.set("active",!0),a.set("passCode",n),a.set("ipAddress",i),t.putModel(a,function(t,e){s(e,t)})}else s(new Error("login not found"))})},y.prototype.resumeSession=function(t,e,r,o){if(!1==t instanceof l)throw new Error("store required");if("string"!=typeof e)throw new Error("ip required");if("string"!=typeof r)throw new Error("passCode required");if("function"!=typeof o)throw new Error("callback required");var i=this;t.getList(new n(i),{ipAddress:e,passCode:r},function(t,e){e?o(e):1==t.length()?(t.moveFirst(),i.set("id",t.get("id")),i.set("userID",t.get("userID")),i.set("dateStarted",t.get("dateStarted")),i.set("passCode",t.get("passCode")),i.set("active",t.get("active")),i.set("ipAddress",t.get("ipAddress")),o(e,i)):o(new Error("session not resumed"))})},y.prototype.endSession=function(t,e){if(!1==t instanceof l)throw new Error("store required");if("function"!=typeof e)throw new Error("callback required");this.get("active")&&this.get("id")||e(this),this.set("active",!1),t.putModel(this,function(t,r){e(r,t)})};var g=function(t){if(!1==this instanceof g)throw new Error("new operator required");(t=t||{}).attributes||(t.attributes=[]),t.attributes.push(new e({name:"name",type:"String(20)"})),t.attributes.push(new e({name:"active",type:"Boolean"})),t.attributes.push(new e({name:"password",type:"String(20)"})),t.attributes.push(new e({name:"firstName",type:"String(35)"})),t.attributes.push(new e({name:"lastName",type:"String(35)"})),t.attributes.push(new e({name:"email",type:"String(20)"})),a.call(this,t),this.modelType="User",this.set("active",!1)};function b(t){if(!1==this instanceof b)throw new Error("new operator required");(t=t||{}).attributes||(t.attributes=[]);var r=new e.ModelID(new g);t.attributes.push(new e({name:"user",type:"Model",value:r})),t.attributes.push(new e({name:"deltas",type:"Object",value:{}})),a.call(this,t),this.modelType="Workspace"}g.prototype=Object.create(a.prototype),a._ModelConstructor.User=g,b.prototype=Object.create(a.prototype),a._ModelConstructor.Workspace=b;var E=function(t){if(!1==this instanceof E)throw new Error("new operator required");t=t||{},this.storeType=t.storeType||"MemoryStore",this.name=t.name||"a "+this.storeType,this.storeProperty={isReady:!0,canGetModel:!0,canPutModel:!0,canDeleteModel:!0,canGetList:!0},this.data=[],this.idCounter=0;for(var e=P(t,["name","storeType"]),r=[],o=0;o<e.length;o++)r.push("invalid property: "+e[o]);if(r.length>1)throw new Error("error creating Store: multiple errors");if(r.length)throw new Error("error creating Store: "+r[0])};E.prototype=Object.create(l.prototype),E.prototype.getModel=function(t,e){var r,o;if(!(t instanceof a))throw new Error("argument must be a Model");if(t.getObjectStateErrors().length)throw new Error("model has validation errors");if(!t.attributes[0].value)throw new Error("ID not set");if("function"!=typeof e)throw new Error("callback required");var i=-1;for(r=0;r<this.data.length;r++)this.data[r][0]==t.modelType&&(i=r);if(i<0)e(t,new Error("model not found in store"));else{var n=t.get("id"),s=this.data[i][1],h=-1;for(r=0;h<0&&r<s.length;r++)s[r][0]==n&&(h=r);if(h<0)e(t,new Error("id not found in store"));else{var c=s[h][1];for(o in t.attributes)t.attributes[o].value=c[t.attributes[o].name];e(t,void 0)}}},E.prototype.putModel=function(t,e){var r,o,i,n,s,h,c;if(!(t instanceof a))throw new Error("argument must be a Model");if(t.getObjectStateErrors().length)throw new Error("model has validation errors");if("function"!=typeof e)throw new Error("callback required");if(i=t.get("ID")){for(n=-1,r=0;r<this.data.length;r++)this.data[r][0]==t.modelType&&(n=r);if(n<0)return void e(t,new Error("model not found in store"));var l=-1;i=t.get("id");var u=this.data[n][1];for(r=0;l<0&&r<u.length;r++)u[r][0]==i&&(l=r);if(l<0)return void e(t,new Error("id not found in store"));for(o in s={},t.attributes)h=t.attributes[o].name,c=t.attributes[o].value,s[h]=c;u[l][1]=s,e(t,void 0)}else{for(n=-1,r=0;r<this.data.length;r++)this.data[r][0]==t.modelType&&(n=r);n<0&&(this.data.push([t.modelType,[]]),n=this.data.length-1);var p=++this.idCounter;for(o in t.set("id",p),s={},t.attributes)h=t.attributes[o].name,c=t.attributes[o].value,s[h]=c;this.data[n][1].push([p,s]),e(t,void 0)}},E.prototype.deleteModel=function(t,e){var r,o;if(!(t instanceof a))throw new Error("argument must be a Model");if(t.getObjectStateErrors().length)throw new Error("model has validation errors");if("function"!=typeof e)throw new Error("callback required");var i=-1;for(r=0;r<this.data.length;r++)this.data[r][0]==t.modelType&&(i=r);if(i<0)e(t,new Error("model not found in store"));else{var n=-1,s=t.get("id"),h=this.data[i][1];for(r=0;n<0&&r<h.length;r++)h[r][0]==s&&(n=r);if(n<0)e(t,new Error("id not found in store"));else{var c=h.splice(n,1)[0][1];for(o in t.attributes)"id"==t.attributes[o].name?t.attributes[o].value=void 0:t.attributes[o].value=c[t.attributes[o].name];e(t,void 0)}}},E.prototype.getList=function(t,e,r,o){var i,s,a;if("function"==typeof o?(i=o,s=r):i=r,!(t instanceof n))throw new Error("argument must be a List");if(t.view)throw new Error("List is View type use getViewList");if(!(e instanceof Object))throw new Error("filter argument must be Object");if("function"!=typeof i)throw new Error("callback required");var h=-1;for(a=0;a<this.data.length;a++)this.data[a][0]==t.model.modelType&&(h=a);if(h<0)i(t);else{t.clear();var c=this.data[h][1];for(a=0;a<c.length;a++){var l=!0;for(var u in e)e.hasOwnProperty(u)&&(e[u]instanceof RegExp?e[u].test(c[a][1][u])||(l=!1):e[u]!=c[a][1][u]&&(l=!1));if(l){var p=[];for(var f in c[a][1])p.push(c[a][1][f]);t._items.push(p)}}t._itemIndex=t._items.length-1,s&&t.sort(s),i(t)}};var k=function(t,e){for(var r=0;r<t.length;r++)if(t[r]===e)return!0;return!1},q=function(t){if(null===t)throw new TypeError;if(Object.create)return Object.create(t);var e=typeof t;if("object"!==e&&"function"!=typeof e)throw new TypeError;function r(){}return r.prototype=t,new r},P=function(t,e){var r=[];for(var o in t)t.hasOwnProperty(o)&&(k(e,o)||r.push(o));return r},_=function(t){return a._ModelConstructor[t]||a},M=function(t){return new(_(t))},C=function(t,e){if("string"!=typeof t)throw new Error("expected CPON string");void 0===e&&(e={});var r=t.indexOf("^");if(r<0)throw new Error("caret (^) not found in garden");var o=S(t,r),i=t.substring(r+1),n=i.indexOf("|");return n>-1&&(e=C(i.substring(n+1),e),i=S(i,n)),e[o]=i,e},S=function(t,e){return t.substring(0,e)},I=function(t,e){return t.substring(t.length-e,t.length)},O=function(t,e){var r=(t.length-e)/2;return t.substring(r,r+e)},T=function(t){return t.replace(/^\s+|\s+$/g,"")},x=function(t){return t.replace(/^\s+/,"")},A=function(t){return t.replace(/\s+$/,"")},L=function(t,e,r){r=r||" ";var o=""+t;if(o.length>e)return S(o,e);for(;o.length<e;)o=r+o;return o},R=function(t,e,r){r=r||" ";var o=""+t;if(o.length>e)return I(o,e);for(;o.length<e;)o+=r;return o},D=function(t,e,r){r=r||" ";var o=""+t,i=e-o.length;if(o.length>e)return O(o,e);var n=o.length+Math.floor(i/2);return o=L(o,n,r),o=R(o,e,r)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t),exports.TGI=t):this.TGI=t}).call(this);