(function(){"use strict";function t(){}function e(){}function r(t,e){var i;if(!1==this instanceof r)throw new Error("new operator required");if("string"==typeof t){var n=t;t={},t.name=n,"string"==typeof e&&(t.type=e)}t=t||{},this.name=t.name||null,this.label=t.label||t.name,this.label&&(this.label=this.label.charAt(0).toUpperCase()+this.label.slice(1)),this.type=t.type||"String",i=function(t){var e=t.split("(");return e[1]=parseInt(e[1]),e}(this.type),this.type=i[0],this.hint=t.hint||{},this.validationRule=t.validationRule||{};var o=[],s=["name","type","label","hint","value","validationRule"];switch(this.type){case"ID":o=getInvalidProperties(t,s),this.value=t.value||null;break;case"String":o=getInvalidProperties(t,s.concat(["placeHolder","quickPick","size"])),this.size=i[1]?i[1]:"number"==typeof t.size?t.size:t.size||50,this.value=t.value||null,t.quickPick&&(this.quickPick=t.quickPick),this.placeHolder=t.placeHolder||null;break;case"Date":o=getInvalidProperties(t,s.concat("placeHolder")),this.value=t.value||null,this.placeHolder=t.placeHolder||null;break;case"Boolean":o=getInvalidProperties(t,s),this.value=t.value===!1?!1:t.value||null;break;case"Number":o=getInvalidProperties(t,s.concat("placeHolder")),this.value=0===t.value?0:t.value||null,this.placeHolder=t.placeHolder||null;break;case"Model":o=getInvalidProperties(t,s),this.value=t.value||null,this.value instanceof r.ModelID&&(this.modelType=this.value.modelType);break;case"Group":o=getInvalidProperties(t,s),this.value=t.value||null;break;case"Table":o=getInvalidProperties(t,s.concat("group")),this.value=t.value||null,this.group=t.group||null;break;case"Object":o=getInvalidProperties(t,s),this.value=t.value||null}for(var a=this.getObjectStateErrors(),u=0;u<o.length;u++)a.push("invalid property: "+o[u]);if(a.length>1)throw new Error("error creating Attribute: multiple errors");if(a.length)throw new Error("error creating Attribute: "+a[0]);this._eventListeners=[],this._errorConditions={}}function i(t){if(!1==this instanceof i)throw new Error("new operator required");if("function"==typeof t){var r=t;t={type:"Function",contents:r}}t=t||{};var n,o=getInvalidProperties(t,["name","description","type","contents","scope","timeout","theme","icon","bucket"]),s=[];for(n=0;n<o.length;n++)s.push("invalid property: "+o[n]);if(s.length>1)throw new Error("error creating Command: multiple errors");if(s.length)throw new Error("error creating Command: "+s[0]);for(n in t)this[n]=t[n];if(this.name=this.name||"(unnamed)","string"!=typeof this.name)throw new Error("name must be string");if("undefined"==typeof this.description&&(this.description=this.name+" Command"),"undefined"==typeof this.type&&(this.type="Stub"),!contains(["Stub","Menu","Presentation","Function","Procedure"],this.type))throw new Error("Invalid command type: "+this.type);switch(this.type){case"Stub":break;case"Menu":if(!(this.contents instanceof Array))throw new Error("contents must be array of menu items");if(!this.contents.length)throw new Error("contents must be array of menu items");for(n in this.contents)if(this.contents.hasOwnProperty(n)&&"string"!=typeof this.contents[n]&&!(this.contents[n]instanceof i))throw new Error("contents must be array of menu items");break;case"Presentation":if(!(this.contents instanceof e))throw new Error("contents must be a Presentation");break;case"Function":if("function"!=typeof this.contents)throw new Error("contents must be a Function");break;case"Procedure":if(!(this.contents instanceof f))throw new Error("contents must be a Procedure")}if("undefined"!=typeof this.scope&&!(this.scope instanceof p||this.scope instanceof c))throw new Error("optional scope property must be Model or List");if("undefined"!=typeof this.timeout&&"number"!=typeof this.timeout)throw new Error("timeout must be a Number");if("undefined"!=typeof this.timeout&&"number"!=typeof this.timeout)throw new Error("timeout must be a Number");if("undefined"!=typeof this.theme){if("string"!=typeof this.theme)throw new Error("invalid theme");if(!contains(["default","primary","success","info","warning","danger","link"],this.theme))throw new Error("invalid theme")}if("undefined"!=typeof this.icon){if("string"!=typeof this.icon)throw new Error("invalid icon");if(!contains(["fa","glyphicon"],this.icon.split("-")[0])||!this.icon.split("-")[1])throw new Error("invalid icon")}this._eventListeners=[]}function n(t){if(!1==this instanceof n)throw new Error("new operator required");if(!1==t instanceof r.ModelID)throw new Error("Attribute.ModelID required in constructor");this.dateCreated=new Date,this.modelID=t,this.attributeValues={}}function o(t){if(!1==this instanceof o)throw new Error("new operator required");t=t||{},t.name=t.name||"(unnamed)",t.description=t.description||"a Interface";var e,r=getInvalidProperties(t,["name","description"]),i=[];for(e=0;e<r.length;e++)i.push("invalid property: "+r[e]);if(i.length>1)throw new Error("error creating Procedure: multiple errors");if(i.length)throw new Error("error creating Procedure: "+i[0]);this.startCallback=null,this.stopCallback=null,this.mocks=[],this.mockPending=!1;for(e in t)this[e]=t[e]}function s(t,e){if(!1==this instanceof s)throw new Error("new operator required");if("undefined"==typeof t)throw new Error("message type required");if(!contains(["Null","Connected","Error","Sent","Ping","PutModel","PutModelAck","GetModel","GetModelAck","DeleteModel","DeleteModelAck","GetList","GetListAck"],t))throw new Error("Invalid message type: "+t);this.type=t,this.contents=e}function a(t){if(!1==this instanceof a)throw new Error("new operator required");if("string"==typeof t){var e=t;t={},t.type=e}if(t=t||{},this.type=t.type||null,!this.type||"string"!=typeof this.type)throw new Error("Request type required");switch(this.type){case"Command":if(this.command=t.command||null,!1==this.command instanceof i)throw new Error("command object required")}}function u(t,e){if(!1==this instanceof u)throw new Error("new operator required");if("string"!=typeof t)throw new Error("argument must a url string");if("function"!=typeof e)throw new Error("argument must a callback");var r=this;r.connected=!1,r.initialConnect=!0,r.location=t,""===r.location&&(r.location="http host"),r.socket=io.connect(t),r.socket.on("connect",function(){r.connected=!0,r.initialConnect=!1,console.log("socket.io ("+r.location+") connected"),e.call(r,new s("Connected",""))}),r.socket.on("connecting",function(){console.log("socket.io ("+r.location+") connecting")}),r.socket.on("error",function(t){var i=t;i.length<1&&(i="(unknown)"),console.error("socket.io ("+r.location+") error: "+i+"."),r.initialConnect&&e.call(r,new s("Error","cannot connect"))}),r.socket.on("connect_failed",function(t){var i=t;i.length<1&&(i="(unknown)"),console.error("socket.io ("+r.location+") connect_failed: "+i+"."),r.initialConnect&&e.call(r,new s("Error","cannot connect"))}),r.socket.on("message",function(t){console.log("socket.io ("+r.location+") message: "+t)}),r.socket.on("disconnect",function(t){r.connected=!1,console.log("socket.io ("+r.location+") disconnect: "+t)})}var h=this,l=function(){return{version:"0.0.7",Application:t,Attribute:r,Command:i,Delta:n,Interface:o,List:c,Message:s,Model:p,Presentation:e,Procedure:f,Request:a,Store:d,Transport:u,injectMethods:function(h){h.Application=t,h.Attribute=r,h.Command=i,h.Delta=n,h.Interface=o,h.List=c,h.Message=s,h.Model=p,h.Presentation=e,h.Procedure=f,h.Request=a,h.Store=d,h.Transport=u}}};r.ModelID=function(t){if(!1==this instanceof r.ModelID)throw new Error("new operator required");if(!1==t instanceof p)throw new Error("must be constructed with Model");this.value=t.get("id"),this.constructorFunction=t.constructor,this.modelType=t.modelType},r.ModelID.prototype.toString=function(){return"string"==typeof this.value?"ModelID("+this.modelType+":'"+this.value+"')":"ModelID("+this.modelType+":"+this.value+")"},r.prototype.toString=function(){return null===this.name?"new Attribute":"Attribute: "+this.name},r.prototype.onEvent=function(t,e){if(!(t instanceof Array)){if("string"!=typeof t)throw new Error("subscription string or array required");t=[t]}if("function"!=typeof e)throw new Error("callback is required");for(var r in t)if(t.hasOwnProperty(r)&&"*"!=t[r]&&!contains(["StateChange","Validate"],t[r]))throw new Error("Unknown command event: "+t[r]);return this._eventListeners.push({events:t,callback:e}),this},r.prototype._emitEvent=function(t){var e;for(e in this._eventListeners)if(this._eventListeners.hasOwnProperty(e)){var r=this._eventListeners[e];(r.events.length&&"*"===r.events[0]||contains(r.events,t))&&r.callback.call(this,t)}},r.prototype.coerce=function(t){var e,r=t;switch(this.type){case"String":return"undefined"==typeof r?"":"boolean"!=typeof r||r?r?(r=t.toString(),r.length>this.size?r.substring(0,this.size):r):"":"false";case"Number":return"undefined"==typeof r?0:r?("string"==typeof r?(r=r.replace(/^\s+|\s+$/g,""),e=r.split(" "),r=e.length?e[0]:"",r=Number(r.replace(/[^/0-9\ \.]+/g,""))):r=Number(r),r?r:0):0;case"Boolean":return"undefined"==typeof r?!1:"string"==typeof r?(r=r.toUpperCase(),"Y"===r||"YES"===r||"T"===r||"TRUE"===r||"1"===r?!0:!1):r?!0:!1;case"Date":return"string"==typeof r&&2==r.split("/").length&&(r=r+"/"+(new Date).getFullYear()),new Date(r)}throw Error("coerce cannot determine appropriate value")},r.prototype.getObjectStateErrors=function(){var t;switch(this.validationErrors=[],this.name||this.validationErrors.push("name required"),contains(["ID","String","Date","Boolean","Number","Model","Group","Table","Object"],this.type)||this.validationErrors.push("Invalid type: "+this.type),this.type){case"ID":break;case"String":"number"!=typeof this.size&&this.validationErrors.push("size must be a number from 1 to 255"),(this.size<1||this.size>255)&&this.validationErrors.push("size must be a number from 1 to 255"),null!==this.value&&"string"!=typeof this.value&&this.validationErrors.push("value must be null or a String");break;case"Date":null===this.value||this.value instanceof Date||this.validationErrors.push("value must be null or a Date");break;case"Boolean":null!==this.value&&"boolean"!=typeof this.value&&this.validationErrors.push("value must be null or a Boolean");break;case"Number":null!==this.value&&"number"!=typeof this.value&&this.validationErrors.push("value must be null or a Number");break;case"Model":this.value instanceof r.ModelID||this.validationErrors.push("value must be Attribute.ModelID");break;case"Group":if(null===this.value||this.value instanceof Array)for(t in this.value)this.value.hasOwnProperty(t)&&(this.value[t]instanceof r||this.validationErrors.push("each element in group must be instance of Attribute"),this.value[t].getObjectStateErrors().length&&this.validationErrors.push("group contains invalid members"));else this.validationErrors.push("value must be null or an array");break;case"Table":if(this.group instanceof r)if(this.group.value instanceof Array)if(this.group.value.length<1)this.validationErrors.push("group property value must contain at least one Attribute");else for(t in this.group.value)this.group.value.hasOwnProperty(t)&&(this.group.value[t]instanceof r||this.validationErrors.push("each element in group must be instance of Attribute"),this.group.value[t].getObjectStateErrors().length&&this.validationErrors.push("group contains invalid members"));else this.validationErrors.push("group.value must be an array");else this.validationErrors.push("group property required")}var e=getInvalidProperties(this.validationRule,["required","range","isOneOf","isValidModel"]);return e.length&&this.validationErrors.push("invalid validationRule: "+e),this.validationMessage=this.validationErrors.length>0?this.validationErrors[0]:"",this.validationErrors},r.prototype.validate=function(t){if("function"!=typeof t)throw new Error("callback is required");this.getObjectStateErrors(),this._emitEvent("Validate");var e;for(e in this._errorConditions)this._errorConditions.hasOwnProperty(e)&&this.validationErrors.push(this._errorConditions[e]);this.validationRule.required&&!this.value&&("Number"==this.type?0!==this.value&&this.validationErrors.push(this.label+" required"):"Boolean"==this.type?this.value!==!1&&this.validationErrors.push(this.label+" required"):this.validationErrors.push(this.label+" required")),this.validationRule.range&&(this.validationRule.range instanceof Array||(this.validationRule.range=[this.validationRule.range]),(this.validationRule.range[0]||0===this.validationRule.range[0])&&this.value<this.validationRule.range[0]&&this.validationErrors.push(this.label+" must be at least "+this.validationRule.range[0]),(this.validationRule.range[1]||0===this.validationRule.range[1])&&this.value>this.validationRule.range[1]&&this.validationErrors.push(this.label+" must be no more than "+this.validationRule.range[1])),this.validationRule.isOneOf&&(this.validationRule.isOneOf instanceof Array||(this.validationRule.isOneOf=[this.validationRule.isOneOf]),-1==this.validationRule.isOneOf.indexOf(this.value)&&this.validationErrors.push(this.label+" invalid")),this.validationMessage=this.validationErrors.length>0?this.validationErrors[0]:"",this._emitEvent("StateChange"),t.call(this)},r.prototype.setError=function(t,e){if(t=t||"",e=e||"",!t)throw new Error("condition required");if(!e)throw new Error("description required");this._errorConditions[t]=e},r.prototype.clearError=function(t){if(t=t||"",!t)throw new Error("condition required");delete this._errorConditions[t]},r.getAttributeTypes=function(){return["ID","String","Date","Boolean","Number","Model","Group","Table","Object"].slice(0)},i.prototype.toString=function(){return this.type+" Command: "+this.name},i.prototype.onEvent=function(t,e){if(!(t instanceof Array)){if("string"!=typeof t)throw new Error("subscription string or array required");t=[t]}if("function"!=typeof e)throw new Error("callback is required");for(var r in t)if(t.hasOwnProperty(r)&&"*"!=t[r]&&!contains(["BeforeExecute","AfterExecute","Error","Aborted","Completed"],t[r]))throw new Error("Unknown command event: "+t[r]);this._eventListeners.push({events:t,callback:e})},i.prototype._emitEvent=function(t){var e;for(e in this._eventListeners)if(this._eventListeners.hasOwnProperty(e)){var r=this._eventListeners[e];(r.events.length&&"*"===r.events[0]||contains(r.events,t))&&r.callback.call(this,t)}"Completed"==t&&(this._eventListeners=[])},i.prototype.execute=function(){function t(){try{s.contents.apply(s,a)}catch(t){s.error=t,s._emitEvent("Error"),s._emitEvent("Completed"),s.status=-1}}function r(){s.status=0;for(var t=s.contents.tasks||[],e=0;e<t.length;e++){if("function"==typeof t[e]){var r=t[e];t[e]={requires:[-1],command:new i({type:"Function",contents:r})}}t[e].command._parentProcedure||(t[e].command._taskIndex=e,t[e].command._parentProcedure=s,t[e].command.onEvent("*",n));var o=!0;if("undefined"==typeof t[e].command.status){for(var a in t[e].requires){if("string"==typeof t[e].requires[a])for(var u=0;u<t.length;u++)t[u].label==t[e].requires[a]&&(!t[u].command.status||t[u].command.status<=0)&&(o=!1);if("number"==typeof t[e].requires[a])if(-1==t[e].requires[a])"0"!=e&&(!t[e-1].command.status||t[e-1].command.status<=0)&&(o=!1);else{var h=t[e].requires[a];(!t[h].command.status||t[h].command.status<=0)&&(o=!1)}}o&&t[e].command.execute()}}}function n(t){var e=s.contents.tasks,i=!0;switch(t){case"Error":s._emitEvent("Error");break;case"Completed":for(var n in e)e.hasOwnProperty(n)&&(e[n].command.status&&0!==e[n].command.status||(i=!1));i?s.complete():r()}}if(!this.type)throw new Error("command not implemented");if(!contains(["Function","Procedure","Presentation"],this.type))throw new Error("command type "+this.type+" not implemented");var o;switch(this.type){case"Presentation":if(!(this.contents instanceof e))throw new Error("contents must be a Presentation");if(o=this.contents.getObjectStateErrors(),o.length)throw new Error(o.length>1?"error executing Presentation: multiple errors":"error executing Presentation: "+o[0])}var s=this,a=arguments;this._emitEvent("BeforeExecute");try{switch(this.type){case"Function":this.status=0,setTimeout(t,0);break;case"Procedure":setTimeout(r,0)}}catch(u){this.error=u,this._emitEvent("Error"),this._emitEvent("Completed"),this.status=-1}this._emitEvent("AfterExecute")},i.prototype.abort=function(){this._emitEvent("Aborted"),this.status=-1,this._emitEvent("Completed")},i.prototype.complete=function(){this.status=1,this._emitEvent("Completed")},o.prototype.toString=function(){return this.description},o.prototype.canMock=function(){return!1},o.prototype.doMock=function(){if(this.mockPending=!1,!(this.mocks.length<1)){var t=this.mocks.shift();this.dispatch(t),this.mockPending=!0;var e=this;setTimeout(function(){e.doMock()},0)}},o.prototype.mockRequest=function(t){if(!(t instanceof Array||t instanceof a))throw new Error("missing request parameter");t instanceof Array||(t=[t]);var e;for(e=0;e<t.length;e++)if(!1==t[e]instanceof a)throw new Error("invalid request parameter");for(e=0;e<t.length;e++)this.mocks.push(t[e]);this.mockPending||this.doMock()},o.prototype.start=function(r,i,n){if(!(r instanceof t))throw new Error("Application required");if(!(i instanceof e))throw new Error("presentation required");if("function"!=typeof n)throw new Error("callBack required");this.application=r,this.presentation=i,this.startCallback=n},o.prototype.stop=function(t){if("function"!=typeof t)throw new Error("callBack required")},o.prototype.dispatch=function(t,e){if(!1==t instanceof a)throw new Error("Request required");if(e&&"function"!=typeof e)throw new Error("response callback is not a function");this.application&&this.application.dispatch(t)||this.startCallback&&this.startCallback(t)},o.prototype.notify=function(t){if(!1==t instanceof a)throw new Error("Request required")},o.prototype.render=function(t,r){if(!1==t instanceof e)throw new Error("Presentation object required");if(r&&"function"!=typeof r)throw new Error("optional second argument must a commandRequest callback function")};var c=function(t){if(!1==this instanceof c)throw new Error("new operator required");if(!1==t instanceof p)throw new Error("argument required: model");this.model=t,this._items=[],this._itemIndex=-1};c.prototype.length=function(){return this._items.length},c.prototype.clear=function(){return this._items=[],this._itemIndex=-1,this},c.prototype.get=function(t){if(this._items.length<1)throw new Error("list is empty");for(var e=0;e<this.model.attributes.length;e++)if(this.model.attributes[e].name.toUpperCase()==t.toUpperCase())return this._items[this._itemIndex][e]},c.prototype.set=function(t,e){if(this._items.length<1)throw new Error("list is empty");for(var r=0;r<this.model.attributes.length;r++)if(this.model.attributes[r].name.toUpperCase()==t.toUpperCase())return void(this._items[this._itemIndex][r]=e);throw new Error("attribute not valid for list model")},c.prototype.addItem=function(t){var e,r=[];if(t)for(e in t.attributes)r.push(t.attributes[e].value);else for(e in this.model.attributes)r.push(void 0);return this._items.push(r),this._itemIndex=this._items.length-1,this},c.prototype.removeItem=function(){return this._items.splice(this._itemIndex,1),this._itemIndex--,this},c.prototype.indexedItem=function(t){return this._items.length<1?!1:0>t?!1:t>=this._items.length?!1:(this._itemIndex=t,!0)},c.prototype.moveNext=function(){return this._items.length<1?!1:this.indexedItem(this._itemIndex+1)},c.prototype.movePrevious=function(){return this._items.length<1?!1:this.indexedItem(this._itemIndex-1)},c.prototype.moveFirst=function(){return this._items.length<1?!1:this.indexedItem(0)},c.prototype.moveLast=function(){return this._items.length<1?!1:this.indexedItem(this._items.length-1)},c.prototype.sort=function(t){var e,r=0;for(var i in t)e||(e=i);if(!e)throw new Error("sort order required");for(var n=1==t[e];r<this.model.attributes.length&&this.model.attributes[r].name!=e;)r++;this._items.sort(function(t,e){if(n){if(t[r]<e[r])return-1;if(t[r]>e[r])return 1}else{if(t[r]>e[r])return-1;if(t[r]<e[r])return 1}return 0})};var p=function(t){var e;if(!1==this instanceof p)throw new Error("new operator required");if(this.modelType="Model",this.attributes=[new r("id","ID")],t=t||{},t.attributes)for(e in t.attributes)t.attributes.hasOwnProperty(e)&&this.attributes.push(t.attributes[e]);var i=getInvalidProperties(t,["attributes"]),n=this.getObjectStateErrors();for(e=0;e<i.length;e++)n.push("invalid property: "+i[e]);if(n.length>1)throw new Error("error creating Model: multiple errors");if(n.length)throw new Error("error creating Model: "+n[0]);this._eventListeners=[],this._errorConditions={}};p.prototype.toString=function(){return"a "+this.modelType},p.prototype.copy=function(t){for(var e=0;e<this.attributes.length;e++)this.attributes[e].value=t.attributes[e].value},p.prototype.getObjectStateErrors=function(){if(this.validationErrors=[],this.attributes instanceof Array)if(this.attributes.length<1)this.validationErrors.push("attributes must not be empty");else for(var t=0;t<this.attributes.length;t++)0!==t||this.attributes[t]instanceof r&&"ID"==this.attributes[t].type||this.validationErrors.push("first attribute must be ID"),this.attributes[t]instanceof r||this.validationErrors.push("attribute must be Attribute");else this.validationErrors.push("attributes must be Array");return void 0===this.tags||this.tags instanceof Array||this.validationErrors.push("tags must be Array or null"),this.validationErrors},p.prototype.get=function(t){for(var e=0;e<this.attributes.length;e++)if(this.attributes[e].name.toUpperCase()==t.toUpperCase())return this.attributes[e].value},p.prototype.getAttributeType=function(t){for(var e=0;e<this.attributes.length;e++)if(this.attributes[e].name.toUpperCase()==t.toUpperCase())return this.attributes[e].type},p.prototype.set=function(t,e){for(var r=0;r<this.attributes.length;r++)if(this.attributes[r].name.toUpperCase()==t.toUpperCase())return void(this.attributes[r].value=e);throw new Error("attribute not valid for model")},p.prototype.validate=function(t){var e,r,i=this,n=0;if("function"!=typeof t)throw new Error("callback is required");i.getObjectStateErrors();for(r in i._errorConditions)i._errorConditions.hasOwnProperty(r)&&i.validationErrors.push(i._errorConditions[r]);if(i.validationErrors.length)return i.validationMessage=i.validationErrors.length>0?i.validationErrors[0]:"",i._emitEvent("StateChange"),void t.call(i);for(e=0;e<i.attributes.length;e++)n++,function(e){setTimeout(function(){e.validate(function(){e.validationErrors.length&&i.validationErrors.push("bush"),0===--n&&(i.validationErrors.length||i._emitEvent("Validate"),i.validationMessage=i.validationErrors.length>0?i.validationErrors[0]:"",i._emitEvent("StateChange"),t.call(i))})},0)}(i.attributes[e])},p.prototype.onEvent=function(t,e){if(!(t instanceof Array)){if("string"!=typeof t)throw new Error("subscription string or array required");t=[t]}if("function"!=typeof e)throw new Error("callback is required");for(var r in t)if(t.hasOwnProperty(r)&&"*"!=t[r]&&!contains(["StateChange","Validate"],t[r]))throw new Error("Unknown command event: "+t[r]);return this._eventListeners.push({events:t,callback:e}),this},p.prototype._emitEvent=function(t){var e;for(e in this._eventListeners)if(this._eventListeners.hasOwnProperty(e)){var r=this._eventListeners[e];(r.events.length&&"*"===r.events[0]||contains(r.events,t))&&r.callback.call(this,t)}},p.prototype.setError=function(t,e){if(t=t||"",e=e||"",!t)throw new Error("condition required");if(!e)throw new Error("description required");this._errorConditions[t]=e},p.prototype.clearError=function(t){if(t=t||"",!t)throw new Error("condition required");delete this._errorConditions[t]},s.prototype.toString=function(){switch(this.type){case"Null":return this.type+" Message";default:return this.type+" Message: "+this.contents}};var f=function(t){if(!1==this instanceof f)throw new Error("new operator required");t=t||{};var e,r=getInvalidProperties(t,["tasks","tasksNeeded","tasksCompleted"]),i=[];for(e=0;e<r.length;e++)i.push("invalid property: "+r[e]);if(i.length>1)throw new Error("error creating Procedure: multiple errors");if(i.length)throw new Error("error creating Procedure: "+i[0]);for(e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);if(i=this.getObjectStateErrors()){if(i.length>1)throw new Error("error creating Procedure: multiple errors");if(i.length)throw new Error("error creating Procedure: "+i[0])}};f.prototype.getObjectStateErrors=function(){var t,e,r,n;if(this.tasks&&!(this.tasks instanceof Array))return["tasks is not an array"];var o=[];for(t in this.tasks)if(this.tasks.hasOwnProperty(t)){var s=this.tasks[t];for(n=getInvalidProperties(s,["label","command","requires","timeout"]),e=0;e<n.length;e++)o.push("invalid task["+t+"] property: "+n[e]);"undefined"!=typeof s.label&&"string"!=typeof s.label&&o.push("task["+t+"].label must be string"),"undefined"==typeof s.command||s.command instanceof i||o.push("task["+t+"].command must be a Command object"),"undefined"==typeof s.requires&&(s.requires=-1),s.requires instanceof Array||(s.requires=[s.requires]);for(e in s.requires)if(s.requires.hasOwnProperty(e)&&null!==s.requires[e])switch(typeof s.requires[e]){case"string":var a=!1;for(r=0;!a&&r<this.tasks.length;r++)s.requires[e]==this.tasks[r].label&&(a=!0);if(!a)throw new Error("missing label: "+s.requires[e]);break;case"number":if(s.requires[e]>=this.tasks.length)throw new Error("missing task #"+s.requires[e]+" for requires in task["+t+"]");if(s.requires[e]<-1)throw new Error("task #"+s.requires[e]+" invalid requires in task["+t+"]");break;default:throw new Error("invalid type for requires in task["+t+"]")}}return o.length?o:null},a.prototype.toString=function(){switch(this.type){case"Command":return this.type+" Request: "+this.command;default:return this.type+" Request"}};var d=function(t){if(!1==this instanceof d)throw new Error("new operator required");t=t||{},this.storeType=t.storeType||"Store",this.name=t.name||"a "+this.storeType,this.storeProperty={isReady:!0,canGetModel:!1,canPutModel:!1,canDeleteModel:!1,canGetList:!1};for(var e=getInvalidProperties(t,["name","storeType"]),r=[],i=0;i<e.length;i++)r.push("invalid property: "+e[i]);if(r.length>1)throw new Error("error creating Store: multiple errors");if(r.length)throw new Error("error creating Store: "+r[0])};d.prototype.toString=function(){return this.name=="a "+this.storeType?this.name:this.storeType+": "+this.name},d.prototype.getServices=function(){return this.storeProperty},d.prototype.onConnect=function(t,e){if("string"!=typeof t)throw new Error("argument must a url string");if("function"!=typeof e)throw new Error("argument must a callback");e(this,void 0)},d.prototype.getModel=function(){throw new Error(this.storeType+" does not provide getModel")},d.prototype.putModel=function(){throw new Error("Store does not provide putModel")},d.prototype.deleteModel=function(){throw new Error("Store does not provide deleteModel")},d.prototype.getList=function(){throw new Error("Store does not provide getList")},u.prototype.send=function(t,e){var r=this;if("undefined"==typeof t)throw new Error("message required");if(!(t instanceof s))throw new Error("parameter must be instance of Message");if("undefined"!=typeof e&&"function"!=typeof e)throw new Error("argument must a callback");return this.connected?void("undefined"!=typeof e?r.socket.emit("ackmessage",t,function(t){e.call(r,t)}):r.socket.send(t)):void e.call(r,new s("Error","not connected"))},u.prototype.close=function(){if(!this.connected)throw new Error("not connected");this.socket.disconnect()},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=l),exports.CORE=l):h.CORE=l}).call(this);