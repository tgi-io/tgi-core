(function(){"use strict";function e(t,i){var r;if(!1==this instanceof e)throw new Error("new operator required");if("string"==typeof t){var a=t;t={},t.name=a,"string"==typeof i&&(t.type=i)}t=t||{},this.name=t.name||null,this.label=t.label||t.name,this.label&&(this.label=this.label.charAt(0).toUpperCase()+this.label.slice(1)),this.type=t.type||"String",r=function(e){var t=e.split("(");return t[1]=parseInt(t[1]),t}(this.type),this.type=r[0],this.hint=t.hint||{},this.validationRule=t.validationRule||{};var s=[],n=["name","type","label","hint","value","validationRule"];switch(this.type){case"ID":s=getInvalidProperties(t,n),this.value=t.value||null;break;case"String":s=getInvalidProperties(t,n.concat(["placeHolder","quickPick","size"])),this.size=r[1]?r[1]:"number"==typeof t.size?t.size:t.size||50,this.value=t.value||null,t.quickPick&&(this.quickPick=t.quickPick),this.placeHolder=t.placeHolder||null;break;case"Date":s=getInvalidProperties(t,n.concat("placeHolder")),this.value=t.value||null,this.placeHolder=t.placeHolder||null;break;case"Boolean":s=getInvalidProperties(t,n),this.value=t.value===!1?!1:t.value||null;break;case"Number":s=getInvalidProperties(t,n.concat("placeHolder")),this.value=0===t.value?0:t.value||null,this.placeHolder=t.placeHolder||null;break;case"Model":s=getInvalidProperties(t,n),this.value=t.value||null,this.value instanceof e.ModelID&&(this.modelType=this.value.modelType);break;case"Group":s=getInvalidProperties(t,n),this.value=t.value||null;break;case"Table":s=getInvalidProperties(t,n.concat("group")),this.value=t.value||null,this.group=t.group||null;break;case"Object":s=getInvalidProperties(t,n),this.value=t.value||null}for(var o=this.getObjectStateErrors(),l=0;l<s.length;l++)o.push("invalid property: "+s[l]);if(o.length>1)throw new Error("error creating Attribute: multiple errors");if(o.length)throw new Error("error creating Attribute: "+o[0]);this._eventListeners=[],this._errorConditions={}}var t=this,i=function(){return{version:"0.0.7",injectMethods:function(t){t.Attribute=e}}};e.ModelID=function(t){if(!1==this instanceof e.ModelID)throw new Error("new operator required");if(!1==t instanceof Model)throw new Error("must be constructed with Model");this.value=t.get("id"),this.constructorFunction=t.constructor,this.modelType=t.modelType},e.ModelID.prototype.toString=function(){return"string"==typeof this.value?"ModelID("+this.modelType+":'"+this.value+"')":"ModelID("+this.modelType+":"+this.value+")"},e.prototype.toString=function(){return null===this.name?"new Attribute":"Attribute: "+this.name},e.prototype.onEvent=function(e,t){if(!(e instanceof Array)){if("string"!=typeof e)throw new Error("subscription string or array required");e=[e]}if("function"!=typeof t)throw new Error("callback is required");for(var i in e)if(e.hasOwnProperty(i)&&"*"!=e[i]&&!contains(["StateChange","Validate"],e[i]))throw new Error("Unknown command event: "+e[i]);return this._eventListeners.push({events:e,callback:t}),this},e.prototype._emitEvent=function(e){var t;for(t in this._eventListeners)if(this._eventListeners.hasOwnProperty(t)){var i=this._eventListeners[t];(i.events.length&&"*"===i.events[0]||contains(i.events,e))&&i.callback.call(this,e)}},e.prototype.coerce=function(e){var t,i=e;switch(this.type){case"String":return"undefined"==typeof i?"":"boolean"!=typeof i||i?i?(i=e.toString(),i.length>this.size?i.substring(0,this.size):i):"":"false";case"Number":return"undefined"==typeof i?0:i?("string"==typeof i?(i=i.replace(/^\s+|\s+$/g,""),t=i.split(" "),i=t.length?t[0]:"",i=Number(i.replace(/[^/0-9\ \.]+/g,""))):i=Number(i),i?i:0):0;case"Boolean":return"undefined"==typeof i?!1:"string"==typeof i?(i=i.toUpperCase(),"Y"===i||"YES"===i||"T"===i||"TRUE"===i||"1"===i?!0:!1):i===!0;case"Date":return"string"==typeof i&&2==i.split("/").length&&(i=i+"/"+(new Date).getFullYear()),new Date(i)}throw Error("coerce cannot determine appropriate value")},e.prototype.getObjectStateErrors=function(){var t;switch(this.validationErrors=[],this.name||this.validationErrors.push("name required"),contains(["ID","String","Date","Boolean","Number","Model","Group","Table","Object"],this.type)||this.validationErrors.push("Invalid type: "+this.type),this.type){case"ID":break;case"String":"number"!=typeof this.size&&this.validationErrors.push("size must be a number from 1 to 255"),(this.size<1||this.size>255)&&this.validationErrors.push("size must be a number from 1 to 255"),null!==this.value&&"string"!=typeof this.value&&this.validationErrors.push("value must be null or a String");break;case"Date":null===this.value||this.value instanceof Date||this.validationErrors.push("value must be null or a Date");break;case"Boolean":null!==this.value&&"boolean"!=typeof this.value&&this.validationErrors.push("value must be null or a Boolean");break;case"Number":null!==this.value&&"number"!=typeof this.value&&this.validationErrors.push("value must be null or a Number");break;case"Model":this.value instanceof e.ModelID||this.validationErrors.push("value must be Attribute.ModelID");break;case"Group":if(null===this.value||this.value instanceof Array)for(t in this.value)this.value.hasOwnProperty(t)&&(this.value[t]instanceof e||this.validationErrors.push("each element in group must be instance of Attribute"),this.value[t].getObjectStateErrors().length&&this.validationErrors.push("group contains invalid members"));else this.validationErrors.push("value must be null or an array");break;case"Table":if(this.group instanceof e)if(this.group.value instanceof Array)if(this.group.value.length<1)this.validationErrors.push("group property value must contain at least one Attribute");else for(t in this.group.value)this.group.value.hasOwnProperty(t)&&(this.group.value[t]instanceof e||this.validationErrors.push("each element in group must be instance of Attribute"),this.group.value[t].getObjectStateErrors().length&&this.validationErrors.push("group contains invalid members"));else this.validationErrors.push("group.value must be an array");else this.validationErrors.push("group property required")}var i=getInvalidProperties(this.validationRule,["required","range","isOneOf","isValidModel"]);return i.length&&this.validationErrors.push("invalid validationRule: "+i),this.validationMessage=this.validationErrors.length>0?this.validationErrors[0]:"",this.validationErrors},e.prototype.validate=function(e){if("function"!=typeof e)throw new Error("callback is required");this.getObjectStateErrors(),this._emitEvent("Validate");var t;for(t in this._errorConditions)this._errorConditions.hasOwnProperty(t)&&this.validationErrors.push(this._errorConditions[t]);this.validationRule.required&&!this.value&&("Number"==this.type?0!==this.value&&this.validationErrors.push(this.label+" required"):"Boolean"==this.type?this.value!==!1&&this.validationErrors.push(this.label+" required"):this.validationErrors.push(this.label+" required")),this.validationRule.range&&(this.validationRule.range instanceof Array||(this.validationRule.range=[this.validationRule.range]),(this.validationRule.range[0]||0===this.validationRule.range[0])&&this.value<this.validationRule.range[0]&&this.validationErrors.push(this.label+" must be at least "+this.validationRule.range[0]),(this.validationRule.range[1]||0===this.validationRule.range[1])&&this.value>this.validationRule.range[1]&&this.validationErrors.push(this.label+" must be no more than "+this.validationRule.range[1])),this.validationRule.isOneOf&&(this.validationRule.isOneOf instanceof Array||(this.validationRule.isOneOf=[this.validationRule.isOneOf]),-1==this.validationRule.isOneOf.indexOf(this.value)&&this.validationErrors.push(this.label+" invalid")),this.validationMessage=this.validationErrors.length>0?this.validationErrors[0]:"",this._emitEvent("StateChange"),e.call(this)},e.prototype.setError=function(e,t){if(e=e||"",t=t||"",!e)throw new Error("condition required");if(!t)throw new Error("description required");this._errorConditions[e]=t},e.prototype.clearError=function(e){if(e=e||"",!e)throw new Error("condition required");delete this._errorConditions[e]},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=i),exports.CORE=i):t.CORE=i}).call(this);